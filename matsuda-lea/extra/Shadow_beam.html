<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Shadow (texture clamp)</title>
  </head>

  <body onload="main()">
    <canvas id="webgl" width="400" height="400">
      Please use a browser that supports "canvas"
    </canvas>

    <script src="../lib/webgl-utils.js"></script>
    <script src="../lib/webgl-debug.js"></script>
    <script src="../lib/cuon-utils.js"></script>
    <script src="../lib/cuon-matrix.js"></script>
    <script type="x-glsl" id="frag-shader">
      #ifdef GL_ES
      precision mediump float;
      #endif
      uniform sampler2D u_ShadowMap;
      varying vec4 v_PositionFromLight;
      varying vec4 v_Color;
      void main() {
        vec3 unshifted = v_PositionFromLight.xyz/v_PositionFromLight.w;
	vec3 shadowCoord = unshifted/2.0 + 0.5;
        vec4 rgbaDepth = texture2D(u_ShadowMap, shadowCoord.xy);
        float depth;
	if (shadowCoord.x < 0.0 || shadowCoord.x >1.0 || shadowCoord.y <0.0 || shadowCoord.y>1.0) {
	// if (length(unshifted.xy) >1.0) {
	  depth=0.0;
	} else {
	  depth = rgbaDepth.r; // Retrieve the z-value from R
	}
        float visibility = (shadowCoord.z > depth + 0.005) ? 0.7 : 1.0;
	  
	gl_FragColor = vec4(v_Color.rgb * visibility, v_Color.a);
      }
    </script>
    <script src="Shadow_beam.js"></script>
  </body>
</html>
